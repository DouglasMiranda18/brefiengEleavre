<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Briefing de Criação de Site — Elevare</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --cor-primaria: #3a8b99;
      --cor-secundaria: #55aebe;
      --cor-bg: #efe2d3;
      --cor-bg2: #d4c0a8;
      --cor-destaque: #826f59;
      --cor-branco: #fff;
      --cor-cinza: #f7f7f7;
      --cor-texto: #222;
    }
    * { box-sizing: border-box; }
    html, body { scroll-behavior: smooth; }
    body {
      font-family: 'Poppins', Inter, Arial, sans-serif;
      background: var(--cor-bg);
      color: var(--cor-texto);
      margin: 0;
      padding: 0;
      min-height: 100vh;
    }
    header {
      background: linear-gradient(180deg, var(--cor-primaria), #3a8b99ee);
      color: var(--cor-branco);
      padding: 1.25rem 1rem 1rem 1rem;
      border-radius: 0 0 32px 32px;
      box-shadow: 0 4px 24px rgba(58,139,153,0.08);
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .header-inner { max-width: 1200px; margin: 0 auto; display: flex; align-items: center; gap: 16px; }
    .brand-logo { width: 56px; height: 56px; object-fit: contain; border-radius: 12px; background: #ffffff24; padding: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
    .logo {
      width: 56px;
      height: 56px;
      background: var(--cor-secundaria);
      border-radius: 12px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 1.3rem;
      font-weight: 600;
      color: var(--cor-branco);
      letter-spacing: 2px;
      box-shadow: 0 2px 8px rgba(85,174,190,0.12);
      user-select: none;
    }
    h1 {
      margin: 0;
      font-size: 1.4rem;
      font-weight: 600;
      letter-spacing: 0.5px;
    }
    .intro {
      font-size: 0.95rem;
      margin-top: 4px;
      color: #f0fbff;
      opacity: 0.9;
    }
    .progress-wrap { max-width: 1200px; margin: 10px auto 0 auto; padding: 0 12px; }
    .progress-bar { height: 8px; background: #ffffff38; border-radius: 999px; overflow: hidden; }
    .progress { height: 100%; width: 0%; background: linear-gradient(90deg, var(--cor-secundaria), #7fd0dc); transition: width 0.25s ease; }

    .layout { max-width: 1200px; margin: 1rem auto; display: grid; grid-template-columns: 260px 1fr; gap: 16px; padding: 0 12px; }
    .side {
      background: var(--cor-branco);
      border-radius: 16px;
      box-shadow: 0 2px 12px rgba(130,111,89,0.08);
      padding: 12px;
      position: sticky;
      top: 110px;
      height: fit-content;
    }
    .side h3 { margin: 6px 8px 10px 8px; font-size: 0.95rem; color: var(--cor-destaque); }
    .nav { list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 4px; }
    .nav a { text-decoration: none; color: var(--cor-primaria); padding: 10px 12px; border-radius: 10px; font-weight: 600; display: block; border: 1px solid #eaeaea; background: var(--cor-cinza); }
    .nav a.active { background: #e6f7fa; border-color: #cfeef5; }

    form {
      background: var(--cor-branco);
      max-width: 100%;
      margin: 0;
      padding: 2rem 1.5rem;
      border-radius: 24px;
      box-shadow: 0 2px 16px rgba(130,111,89,0.08);
      display: flex;
      flex-direction: column;
      gap: 2rem;
    }
    .section-card { border: none; border-radius: 16px; background: var(--cor-cinza); padding: 1.25rem 1rem 1rem 1rem; margin: 0; box-shadow: 0 1px 4px rgba(58,139,153,0.04); }
    legend { font-size: 1.05rem; font-weight: 700; color: var(--cor-primaria); margin-bottom: 0.75rem; letter-spacing: 0.3px; display: flex; align-items: center; gap: 8px; }
    .badge { width: 26px; height: 26px; border-radius: 8px; background: var(--cor-primaria); color: #fff; display: inline-flex; align-items: center; justify-content: center; font-size: 0.85rem; }

    label { display: block; margin-bottom: 0.3rem; font-weight: 500; color: var(--cor-destaque); }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px 16px; }
    .grid .full { grid-column: 1 / -1; }

    input, select, textarea {
      width: 100%;
      padding: 0.7rem 1rem;
      border: 1px solid #ddd;
      border-radius: 10px;
      font-size: 1rem;
      background: var(--cor-branco);
      font-family: inherit;
      transition: border 0.2s, box-shadow 0.2s;
    }
    input:focus, textarea:focus, select:focus {
      border-color: var(--cor-primaria);
      outline: none;
      box-shadow: 0 0 0 4px rgba(58,139,153,0.12);
    }
    .auto-save {
      font-size: 0.95rem;
      color: var(--cor-primaria);
      background: #e6f7fa;
      border-radius: 8px;
      padding: 0.5rem 1rem;
      margin-bottom: 0.5rem;
      display: inline-block;
      box-shadow: 0 1px 4px rgba(58,139,153,0.04);
    }
    .actions { display: flex; align-items: center; justify-content: flex-end; gap: 10px; position: sticky; bottom: 20px; padding-top: 4px; }
    .btn {
      background: linear-gradient(90deg, var(--cor-primaria), var(--cor-secundaria));
      color: var(--cor-branco);
      border: none;
      border-radius: 32px;
      padding: 1rem 2.2rem;
      font-size: 1.05rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(58,139,153,0.10);
      transition: background 0.2s, box-shadow 0.2s, transform 0.06s ease;
    }
    .btn:hover { background: linear-gradient(90deg, var(--cor-secundaria), var(--cor-primaria)); box-shadow: 0 6px 18px rgba(85,174,190,0.22); }
    .btn:active { transform: translateY(1px); }
    .clear-btn { background: var(--cor-bg2); color: var(--cor-destaque); border: none; border-radius: 24px; padding: 0.7rem 1.2rem; font-size: 0.95rem; cursor: pointer; }
    .clear-btn:hover { background: #e9d8c3; }

    .success-message { background: #e6f7fa; color: var(--cor-primaria); border-radius: 10px; padding: 1rem; margin-top: 1.2rem; text-align: center; font-weight: 700; font-size: 1rem; box-shadow: 0 1px 4px rgba(58,139,153,0.06); display: none; }

    @media (max-width: 1024px) {
      .layout { grid-template-columns: 1fr; }
      .side { position: relative; top: 0; order: -1; }
    }
    @media (max-width: 600px) {
      .grid { grid-template-columns: 1fr; }
      header { padding: 0.9rem 0.7rem; }
      .brand-logo, .logo { width: 48px; height: 48px; }
      h1 { font-size: 1.1rem; }
      .intro { font-size: 0.85rem; }
      form { padding: 1.2rem 0.9rem; }
      .section-card { padding: 1rem; }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-inner">
      <img id="brandImg" class="brand-logo" src="logo-elevare.png" alt="Logo Elevare" onerror="this.style.display='none';document.getElementById('brandFallback').style.display='inline-flex';">
      <div id="brandFallback" class="logo" style="display:none">E</div>
      <div>
        <h1>Briefing de Criação de Site — Elevare</h1>
        <div class="intro">Preencha este formulário para entendermos estilo, funcionalidades e necessidades do seu projeto.</div>
      </div>
    </div>
    <div class="progress-wrap"><div class="progress-bar"><div class="progress" id="progress"></div></div></div>
  </header>

  <div class="layout">
    <aside class="side">
      <h3>Seções</h3>
      <nav>
        <ul class="nav" id="sideNav">
          <li><a href="#sec-identidade">1. Identidade Visual</a></li>
          <li><a href="#sec-estrutura">2. Estrutura do Site</a></li>
          <li><a href="#sec-loja">3. Loja Virtual</a></li>
          <li><a href="#sec-eventos">4. Eventos e Reservas</a></li>
          <li><a href="#sec-associados">5. Área de Associados</a></li>
          <li><a href="#sec-noticias">6. Notícias</a></li>
          <li><a href="#sec-patrocinadores">7. Patrocinadores</a></li>
          <li><a href="#sec-suporte">8. Suporte</a></li>
          <li><a href="#sec-painel">9. Painel Admin</a></li>
          <li><a href="#sec-ux">10. Experiência do Usuário</a></li>
          <li><a href="#sec-integracoes">11. Integrações Extras</a></li>
        </ul>
      </nav>
    </aside>

    <main>
      <form id="briefingForm" autocomplete="off">
        <div class="auto-save" id="autoSaveMsg">Progresso salvo automaticamente</div>

        <fieldset id="sec-identidade" class="section-card">
          <legend><span class="badge">1</span>Identidade Visual e Estilo</legend>
          <div class="grid">
            <div class="full">
              <label for="logo">Pode me enviar o logo em alta resolução?</label>
              <input type="file" id="logo" name="logo" accept="image/png, image/svg+xml, image/jpeg, application/pdf">
            </div>
            <div>
              <label for="paleta">Qual a paleta oficial de cores?</label>
              <input type="text" id="paleta" name="paleta" placeholder="Ex: #3a8b99, #55aebe, ...">
            </div>
            <div>
              <label for="tipografia">Existe alguma fonte oficial ou tipografia?</label>
              <input type="text" id="tipografia" name="tipografia">
            </div>
            <div class="full">
              <label for="exemploSite">Tem algum exemplo de site ou design gamer/futurista que você gosta?</label>
              <textarea id="exemploSite" name="exemploSite" rows="2"></textarea>
            </div>
            <div class="full">
              <label for="elementosVisuais">Algum elemento visual adicional?</label>
              <textarea id="elementosVisuais" name="elementosVisuais" rows="2"></textarea>
            </div>
          </div>
        </fieldset>

        <fieldset id="sec-estrutura" class="section-card">
          <legend><span class="badge">2</span>Estrutura do Site</legend>
          <div class="grid">
            <div class="full">
              <label for="secoesHome">Quais seções quer na página inicial?</label>
              <textarea id="secoesHome" name="secoesHome" rows="2"></textarea>
            </div>
            <div class="full">
              <label for="paginasAdicionais">Que páginas adicionais deseja?</label>
              <textarea id="paginasAdicionais" name="paginasAdicionais" rows="2"></textarea>
            </div>
            <div>
              <label for="tipoSite">Prefere site de rolagem única ou várias páginas?</label>
              <select id="tipoSite" name="tipoSite">
                <option value="">Selecione</option>
                <option value="rolagemUnica">Rolagem única</option>
                <option value="variasPaginas">Várias páginas</option>
              </select>
            </div>
            <div class="full">
              <label for="animacoes">Quer animações ou efeitos especiais?</label>
              <textarea id="animacoes" name="animacoes" rows="2"></textarea>
            </div>
          </div>
        </fieldset>

        <fieldset id="sec-loja" class="section-card">
          <legend><span class="badge">3</span>Loja Virtual</legend>
          <div class="grid">
            <div class="full">
              <label for="produtos">Lista completa de produtos físicos e digitais</label>
              <textarea id="produtos" name="produtos" rows="3" placeholder="Nome, descrição, preço, categoria, fotos..."></textarea>
            </div>
            <div>
              <label for="entregaDigital">Entrega dos produtos digitais</label>
              <select id="entregaDigital" name="entregaDigital">
                <option value="">Selecione</option>
                <option value="download">Download</option>
                <option value="whatsapp">WhatsApp</option>
                <option value="email">E-mail</option>
              </select>
            </div>
            <div>
              <label for="produtoDestaque">Produto em destaque?</label>
              <input type="text" id="produtoDestaque" name="produtoDestaque">
            </div>
            <div>
              <label for="pagamento">Métodos de pagamento</label>
              <input type="text" id="pagamento" name="pagamento" placeholder="PIX, cartão, etc.">
            </div>
            <div class="full">
              <label for="promocoes">Deseja promoções ou cupons?</label>
              <textarea id="promocoes" name="promocoes" rows="2"></textarea>
            </div>
          </div>
        </fieldset>

        <fieldset id="sec-eventos" class="section-card">
          <legend><span class="badge">4</span>Eventos e Reservas</legend>
          <div class="grid">
            <div>
              <label for="tiposEventos">Tipos de eventos</label>
              <input type="text" id="tiposEventos" name="tiposEventos" placeholder="X-Treinos, Camps, etc.">
            </div>
            <div>
              <label for="datasHorarios">Datas e horários disponíveis</label>
              <input type="text" id="datasHorarios" name="datasHorarios">
            </div>
            <div>
              <label for="limiteParticipantes">Limite de participantes</label>
              <input type="number" id="limiteParticipantes" name="limiteParticipantes" min="1">
            </div>
            <div>
              <label for="valorInscricao">Valor de inscrição ou gratuito?</label>
              <input type="text" id="valorInscricao" name="valorInscricao">
            </div>
            <div>
              <label for="categoriasParticipacao">Categorias de participação</label>
              <input type="text" id="categoriasParticipacao" name="categoriasParticipacao">
            </div>
            <div class="full">
              <label for="regrasCancelamento">Regras de cancelamento</label>
              <textarea id="regrasCancelamento" name="regrasCancelamento" rows="2"></textarea>
            </div>
            <div>
              <label for="pagamentoOnline">Pagamento online?</label>
              <select id="pagamentoOnline" name="pagamentoOnline">
                <option value="">Selecione</option>
                <option value="sim">Sim</option>
                <option value="nao">Não</option>
              </select>
            </div>
          </div>
        </fieldset>

        <fieldset id="sec-associados" class="section-card">
          <legend><span class="badge">5</span>Área de Associados / Login</legend>
          <div class="grid">
            <div>
              <label for="tiposCargos">Tipos de cargos/níveis</label>
              <input type="text" id="tiposCargos" name="tiposCargos" placeholder="Vendedor, Associado, VIP, Admin">
            </div>
            <div>
              <label for="tokens">Distribuição e validade de tokens</label>
              <input type="text" id="tokens" name="tokens">
            </div>
            <div class="full">
              <label for="permissoes">Permissões de cada cargo</label>
              <textarea id="permissoes" name="permissoes" rows="2"></textarea>
            </div>
            <div class="full">
              <label for="camposObrigatorios">Campos obrigatórios no cadastro</label>
              <input type="text" id="camposObrigatorios" name="camposObrigatorios" placeholder="nome, e-mail, celular, nickname...">
            </div>
          </div>
        </fieldset>

        <fieldset id="sec-noticias" class="section-card">
          <legend><span class="badge">6</span>Notícias / Atualizações</legend>
          <div class="grid">
            <div>
              <label for="frequenciaPostagens">Frequência de postagens</label>
              <input type="text" id="frequenciaPostagens" name="frequenciaPostagens">
            </div>
            <div>
              <label for="tiposConteudo">Tipos de conteúdo</label>
              <input type="text" id="tiposConteudo" name="tiposConteudo" placeholder="texto, imagem, vídeo">
            </div>
            <div>
              <label for="categoriasNoticias">Categorias de notícias</label>
              <input type="text" id="categoriasNoticias" name="categoriasNoticias">
            </div>
            <div>
              <label for="integracaoNewsletter">Integração com newsletter ou WhatsApp?</label>
              <input type="text" id="integracaoNewsletter" name="integracaoNewsletter">
            </div>
          </div>
        </fieldset>

        <fieldset id="sec-patrocinadores" class="section-card">
          <legend><span class="badge">7</span>Apoiadores e Patrocinadores</legend>
          <div class="grid">
            <div class="full">
              <label for="listaPatrocinadores">Lista de patrocinadores (logo + link)</label>
              <textarea id="listaPatrocinadores" name="listaPatrocinadores" rows="2"></textarea>
            </div>
            <div>
              <label for="ordemPatrocinadores">Ordem de exibição ou destaque</label>
              <input type="text" id="ordemPatrocinadores" name="ordemPatrocinadores">
            </div>
            <div>
              <label for="categoriasPatrocinadores">Categorias de patrocinadores</label>
              <input type="text" id="categoriasPatrocinadores" name="categoriasPatrocinadores" placeholder="principal, parceiro, etc.">
            </div>
          </div>
        </fieldset>

        <fieldset id="sec-suporte" class="section-card">
          <legend><span class="badge">8</span>Suporte</legend>
          <div class="grid">
            <div>
              <label for="chat">Chat no site</label>
              <input type="text" id="chat" name="chat" placeholder="WhatsApp, Messenger, interno">
            </div>
            <div>
              <label for="atendimento">Atendimento horário ou 24h?</label>
              <input type="text" id="atendimento" name="atendimento">
            </div>
            <div>
              <label for="faq">FAQ ou central de ajuda?</label>
              <input type="text" id="faq" name="faq">
            </div>
          </div>
        </fieldset>

        <fieldset id="sec-painel" class="section-card">
          <legend><span class="badge">9</span>Painel Administrativo</legend>
          <div class="grid">
            <div>
              <label for="acessoPainel">Quem terá acesso?</label>
              <input type="text" id="acessoPainel" name="acessoPainel">
            </div>
            <div class="full">
              <label for="gestaoPainel">O que cada usuário pode gerenciar?</label>
              <textarea id="gestaoPainel" name="gestaoPainel" rows="2"></textarea>
            </div>
            <div class="full">
              <label for="relatorios">Deseja relatórios de vendas, inscrições, downloads, etc.?</label>
              <textarea id="relatorios" name="relatorios" rows="2"></textarea>
            </div>
          </div>
        </fieldset>

        <fieldset id="sec-ux" class="section-card">
          <legend><span class="badge">10</span>Experiência do Usuário e Responsividade</legend>
          <div class="grid">
            <div>
              <label for="prioridadeDispositivos">Prioridade de dispositivos</label>
              <input type="text" id="prioridadeDispositivos" name="prioridadeDispositivos" placeholder="PC, celular, tablet">
            </div>
            <div>
              <label for="tipoNavegacao">Tipo de navegação</label>
              <input type="text" id="tipoNavegacao" name="tipoNavegacao" placeholder="menu fixo, barra lateral, scroll infinito">
            </div>
            <div>
              <label for="efeitosEspeciais">Efeitos especiais</label>
              <input type="text" id="efeitosEspeciais" name="efeitosEspeciais" placeholder="hover, glow, transições">
            </div>
          </div>
        </fieldset>

        <fieldset id="sec-integracoes" class="section-card">
          <legend><span class="badge">11</span>Integrações Extras</legend>
          <div class="grid">
            <div>
              <label for="formasPagamento">Formas de pagamento</label>
              <input type="text" id="formasPagamento" name="formasPagamento" placeholder="PIX, cartão, PayPal, outros">
            </div>
            <div>
              <label for="loginRedesSociais">Login via redes sociais</label>
              <input type="text" id="loginRedesSociais" name="loginRedesSociais">
            </div>
            <div>
              <label for="envioAutomatico">Envio automático de itens digitais</label>
              <input type="text" id="envioAutomatico" name="envioAutomatico" placeholder="WhatsApp, e-mail">
            </div>
            <div>
              <label for="analytics">Analytics</label>
              <input type="text" id="analytics" name="analytics" placeholder="Google Analytics, Pixel do Instagram/Facebook">
            </div>
            <div>
              <label for="feedRedesSociais">Feed automático das redes sociais</label>
              <input type="text" id="feedRedesSociais" name="feedRedesSociais">
            </div>
          </div>
        </fieldset>

        <div class="actions">
          <button type="button" class="clear-btn" id="clearBtn">Limpar respostas</button>
          <button type="submit" class="btn">Enviar Briefing</button>
        </div>
        <div class="success-message" id="successMsg">Briefing enviado com sucesso! Obrigado por compartilhar seu projeto com a Elevare.</div>
      </form>
    </main>
  </div>

  <script type="module">
    // Firebase SDK (modular)
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js';
    import { getFirestore, collection, addDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js';
    // Optional: analytics
    // import { getAnalytics } from 'https://www.gstatic.com/firebasejs/10.12.4/firebase-analytics.js';

    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyCray6IDDaZ-n76vChV2KKuu17SECL5hXY",
      authDomain: "elevare-981b1.firebaseapp.com",
      projectId: "elevare-981b1",
      storageBucket: "elevare-981b1.firebasestorage.app",
      messagingSenderId: "1034421294665",
      appId: "1:1034421294665:web:f2535ece4f604ca4a21198",
      measurementId: "G-BGJJVBSE2C"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    // const analytics = getAnalytics(app);
    // --- Salvamento automático LocalStorage ---
    const form = document.getElementById('briefingForm');
    const autoSaveMsg = document.getElementById('autoSaveMsg');
    const clearBtn = document.getElementById('clearBtn');
    const successMsg = document.getElementById('successMsg');
    const STORAGE_KEY = 'elevare_briefing';

    function loadFormData() {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) {
        try {
          const data = JSON.parse(saved);
          for (const [key, value] of Object.entries(data)) {
            const field = form.elements[key];
            if (field) {
              if (field.type === 'file') continue;
              field.value = value;
            }
          }
        } catch {}
      }
    }
    function saveFormData() {
      const data = {};
      for (const el of form.elements) {
        if (!el.name) continue;
        if (el.type === 'file') continue;
        data[el.name] = el.value;
      }
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      autoSaveMsg.style.opacity = 1;
      setTimeout(() => { autoSaveMsg.style.opacity = 0.5; }, 2000);
      updateProgress();
    }

    clearBtn.addEventListener('click', () => {
      if (confirm('Tem certeza que deseja limpar todas as respostas?')) {
        localStorage.removeItem(STORAGE_KEY);
        for (const el of form.elements) {
          if (!el.name) continue;
          if (el.type === 'file') { el.value = ''; continue; }
          el.value = '';
        }
        saveFormData();
      }
    });

    form.addEventListener('input', saveFormData);
    loadFormData();
    autoSaveMsg.style.opacity = 0.5;

    // --- Progresso ---
    const progressEl = document.getElementById('progress');
    function updateProgress() {
      const fields = Array.from(form.querySelectorAll('input, textarea, select'))
        .filter(el => el.type !== 'file' && el.type !== 'button' && el.type !== 'submit');
      const filled = fields.filter(el => String(el.value).trim().length > 0).length;
      const pct = fields.length ? Math.round((filled / fields.length) * 100) : 0;
      progressEl.style.width = pct + '%';
    }
    updateProgress();

    // --- Envio do formulário ---
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const obrigatorios = ['paleta', 'tipoSite', 'produtos'];
      let erro = false;
      obrigatorios.forEach(id => {
        const el = form.elements[id];
        if (el && !el.value) {
          el.style.borderColor = 'red';
          erro = true;
        } else if (el) {
          el.style.borderColor = '';
        }
      });
      if (erro) {
        alert('Por favor, preencha todos os campos obrigatórios destacados.');
        return;
      }
      try {
        const dataToSend = {};
        for (const el of form.elements) {
          if (!el.name) continue;
          if (el.type === 'file') continue; // envio de arquivo pode ser adicionado ao Storage
          dataToSend[el.name] = el.value;
        }
        dataToSend.createdAt = serverTimestamp();
        await addDoc(collection(db, 'briefings'), dataToSend);
        successMsg.style.display = 'block';
        setTimeout(() => { successMsg.style.display = 'none'; }, 6000);
        form.scrollIntoView({ behavior: 'smooth' });
      } catch (err) {
        console.error(err);
        alert('Não foi possível enviar agora. Verifique sua conexão e tente novamente.');
      }
    });

    // --- Navegação lateral (scrollspy) ---
    const links = Array.from(document.querySelectorAll('#sideNav a'));
    const sections = links.map(a => document.querySelector(a.getAttribute('href')));
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        const idx = sections.indexOf(entry.target);
        if (idx >= 0) {
          const link = links[idx];
          if (entry.isIntersecting) {
            links.forEach(l => l.classList.remove('active'));
            link.classList.add('active');
          }
        }
      });
    }, { rootMargin: '-40% 0px -55% 0px', threshold: [0, 0.2, 1] });
    sections.forEach(sec => sec && observer.observe(sec));
  </script>
</body>
</html>
